language: python

services: postgresql

branches:
  only:
    - master
    - develop

install: 
 - pip install -e .[dev,server]
 - pip install codecov

before_script:
  - createdb -U postgres balsam
  - balsam/server/manage.py makemigrations
  - balsam/server/manage.py migrate
  - python balsam/server/dev/bootstrap.py

script:
  - black --check balsam/
  - flake8 balsam/
  - pytest --cov-report term --cov=balsam/server balsam/server

after_success:
  - codecov

env:
  - CODECOV_TOKEN="18c7c1bf-36fe-4e92-aa15-264c255032bf"
